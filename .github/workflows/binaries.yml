# This workflow will build a .NET project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-net

name: MakeBinaries

on:
  workflow_dispatch:
  release:
    types: [published]
jobs:
  binaries:

    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
    - uses: actions/checkout@v5
      with:
        fetch-depth: 0
    - name: Setup .NET
      uses: actions/setup-dotnet@v5
      with:
        dotnet-version: 10.0.x
    - name: Restore dependencies
      run: dotnet restore
    - name: Run "MakeBinaries.cs"
      run: dotnet run --file ./MakeBinaries.cs
    - name: Get current tag
      run: echo "currentTag=`echo $(git describe --tags --abbrev=0)`" >> $GITHUB_ENV
    - name: Upload binaries to release
      uses: svenstaro/upload-release-action@v2
      with:
        repo_token: ${{ secrets.GITHUB_TOKEN }}
        file: ./bin/zip/CSTOJS_CLI-*
        tag: ${{ env.currentTag }}
        overwrite: true
        file_glob: true
